name: Build and Release Extension - Lite Version

on:
  push:
    tags:
      - 'v*.*.*L'     # Matches v1.2.3L (L suffix for Lite)
      - 'v*.*.*.*L'   # Matches v1.2.3.4L
  workflow_dispatch:

jobs:
  build-and-release-lite:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Get version from manifest
        id: get_version
        run: |
          VERSION=$(grep -oP '(?<="version": ")[^"]*' manifest.json)
          echo "version=$VERSION" >> $GITHUB_OUTPUT
          echo "Extension version: $VERSION (Lite)"

      - name: Create XPI file (Lite Version)
        run: |
          # Remove .github directory from the package
          mkdir -p build
          rsync -av --exclude='.git' --exclude='.github' --exclude='build' --exclude='README.md' --exclude='.gitignore' --exclude='updates.json' . build/
          cd build
          zip -r ../copy-url-hover-lite-extension.xpi .
          cd ..
          echo "‚úì Lite version XPI file created successfully"

      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          files: copy-url-hover-lite-extension.xpi
          append_body: true
          body: |
            ## ü™∂ Copy URL on Hover - Lite Edition v${{ steps.get_version.outputs.version }}
            
            > **This is the LITE version** - focused on core URL copying functionality without Quick Tabs features.

            ### ‚ú® What's in the Lite Version?
            
            ‚úì Copy URLs or link text by pressing keyboard shortcuts  
            ‚úì Open links in new tabs with customizable focus behavior  
            ‚úì Visual notifications with customizable colors, borders, and animations  
            ‚úì **NEW:** Tooltip mode (follows cursor) or Notification mode (fixed corner)  
            ‚úì **NEW:** Customizable tooltip color, animation, and duration  
            ‚úì Fully customizable through settings popup  
            ‚úì Supports 100+ websites with site-specific optimized handlers  
            ‚úì Debug mode for troubleshooting  
            ‚úì Automatic settings sync across all tabs  
            ‚úì Dark mode support

            ### üì¶ Installation Instructions

            1. Download the `copy-url-hover-lite-extension.xpi` file below
            2. Open your Firefox/Zen Browser
            3. Navigate to `about:addons`
            4. Click the gear icon (‚öôÔ∏è) and select "Install Add-on From File..."
            5. Select the downloaded `.xpi` file
            6. Click "Add" when prompted

            ### üîÑ Auto-Update Setup

            Once installed, the extension will automatically check for updates and notify you when a new version is available.
            
            ### üìù Differences from Full Version
            
            The Lite version **removes** Quick Tabs functionality for a smaller, more focused extension:
            - ‚ùå No Quick Tabs (floating iframe windows)
            - ‚ùå No Quick Tab navigation controls
            - ‚ùå No minimize/restore Quick Tab functionality
            
            For the full-featured version with Quick Tabs, check out the main branch releases.
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
