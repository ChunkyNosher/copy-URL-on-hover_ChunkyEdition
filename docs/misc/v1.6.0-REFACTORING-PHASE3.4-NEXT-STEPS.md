# v1.6.0 Refactoring - Phase 3.4 Next Steps

**For the Next GitHub Copilot Coding Agent**

**Date Created:** 2025-11-19  
**Previous Phase:** Phase 2.9 Task 2 (DragController extraction - COMPLETE)  
**Current Context:** DragController created with 20 tests, all 542 tests
passing, ready for integration

---

## ðŸ“‹ Quick Status Check

### Current State (After Phase 2.9 Task 2 Complete)

âœ… **Tests:** 542/542 passing (+20 from last session)  
âœ… **Build:** Successful  
âœ… **Phase 2.9 Task 2:** DragController extracted with comprehensive tests  
âœ… **ESLint errors:** 57 total (unchanged - none in new code)  
âœ… **ESLint warnings:** 21 total (note: checklist said 16, actual is 21)  
âœ… **DragController:** 139 lines, cc<6, 20 tests, 100% coverage

### Phase 2.9 Progress (50% Complete)

**Completed Tasks:**

- âœ… Task 1: ResizeController integration (from previous session)
- âœ… Task 2: DragController extraction (THIS SESSION)

**Remaining Tasks:**

- ðŸ”„ Task 3: Integrate DragController into window.js
- ðŸ”„ Task 4: Extract TitlebarBuilder component
- ðŸ”„ Task 5: Extract WindowStyler (optional)
- ðŸ”„ Task 6: Add WindowFactory (optional)

---

## ðŸŽ¯ Your Mission: Complete Phase 2.9 and/or Start Phase 2.10

You have **three viable paths** forward:

### Path A: Complete Phase 2.9 (Window Components) â­ RECOMMENDED

**Time Estimate:** 2-3 hours  
**Impact:** Finish Window.js refactoring, reduce complexity  
**Priority:** High - DragController is ready, just needs integration

### Path B: Start Phase 2.10 (Quick Tabs Completion)

**Time Estimate:** 4-5 hours  
**Impact:** Extract ManagerPanelUI and NavigationBar components  
**Priority:** Medium - UI components work but have technical debt

### Path C: Start Phase 4 (Content Script Refactor)

**Time Estimate:** 8-12 hours  
**Impact:** Modularize content.js, extract site handlers  
**Priority:** High - content.js is the largest monolithic file

**Recommendation:** **Choose Path A (Phase 2.9)** to complete window component
work before moving forward. It's quick, DragController is ready, and tests are
passing.

---

## ðŸ“ Path A: Phase 2.9 Remaining Tasks

### Task 3: Integrate DragController into window.js (1-1.5 hours)

**Current State:**

- DragController exists in `src/features/quick-tabs/window/DragController.js`
- window.js has old drag logic (~80 lines in setupDragHandlers and related
  methods)
- Need to replace with DragController facade

**Steps:**

1. **Import DragController in window.js:**

```javascript
import { DragController } from './window/DragController.js';
import { ResizeController } from './window/ResizeController.js';
```

2. **Find and replace old drag logic:**

Current window.js has drag logic scattered across methods. Search for:

- `setupDragHandlers()` method (if it exists)
- `isDragging` property references
- `dragStartX`, `dragStartY` properties
- `handleMouseDown`, `handleMouseMove`, `handleMouseUp` for titlebar dragging

3. **Replace with DragController:**

In the `render()` method (where ResizeController is set up):

```javascript
render() {
  // ... existing code ...

  // v1.6.0 Phase 2.9 - Use DragController facade pattern
  const titlebar = this.container.querySelector('.quick-tab-titlebar');
  this.dragController = new DragController(titlebar, {
    onDragStart: (x, y) => {
      console.log('[QuickTab] Drag started:', x, y);
      this.isDragging = true;
    },
    onDrag: (newX, newY) => {
      // Update position
      this.left = newX;
      this.top = newY;
      this.container.style.left = `${newX}px`;
      this.container.style.top = `${newY}px`;

      // Call position change callback
      if (this.onPositionChange) {
        this.onPositionChange(this.id, newX, newY);
      }
    },
    onDragEnd: (finalX, finalY) => {
      console.log('[QuickTab] Drag ended:', finalX, finalY);
      this.isDragging = false;

      // Call position change end callback for persistence
      if (this.onPositionChangeEnd) {
        this.onPositionChangeEnd(this.id, finalX, finalY);
      }
    }
  });

  // ... rest of render method ...
}
```

4. **Add cleanup in destroy method:**

```javascript
destroy() {
  // Clean up drag controller
  if (this.dragController) {
    this.dragController.destroy();
    this.dragController = null;
  }

  // Clean up resize controller (already exists)
  if (this.resizeController) {
    this.resizeController.destroy();
    this.resizeController = null;
  }

  // ... rest of cleanup ...
}
```

5. **Remove old drag-related properties from \_initializeState():**

Remove or keep these for backward compatibility (check if still used):

- `this.isDragging` - Keep for external checks, set by callbacks
- `this.dragStartX` - REMOVE (DragController handles internally)
- `this.dragStartY` - REMOVE (DragController handles internally)

**Expected Result:**

- window.js: -60 to -80 lines (old drag logic removed)
- Complexity reduced: Drag logic cc<6 (from inline event handlers)
- Tests: 542/542 still passing (no new tests needed if behavior unchanged)
- Drag behavior: Identical to before, but smoother on high-refresh monitors

**Verification:**

```bash
# Build
npm run build

# Test
npm test

# Check line count decreased
wc -l src/features/quick-tabs/window.js
# Should be ~800 lines (was 880)

# Lint
npx eslint src/features/quick-tabs/window.js
# Should have no new errors
```

---

### Task 4: Extract TitlebarBuilder Component (1-2 hours)

**Problem:** `createTitlebar()` method in window.js is 157 lines (ESLint
warning: max-lines-per-function)

**Current State:**

- window.js line 219: `createTitlebar()` creates titlebar, navigation buttons,
  zoom controls, solo/mute buttons
- 157 lines of DOM creation, event handlers, styling
- cc likely >9 due to multiple conditional branches

**Solution:** Extract into TitlebarBuilder class

**Create:** `src/features/quick-tabs/window/TitlebarBuilder.js`

```javascript
/**
 * TitlebarBuilder - Creates Quick Tab titlebar with navigation and controls
 *
 * Extracted from QuickTabWindow.createTitlebar() to reduce complexity
 * and improve reusability.
 *
 * @see docs/misc/v1.6.0-REFACTORING-PHASE3.4-NEXT-STEPS.md
 */

import { createElement } from '../../../utils/dom.js';

export class TitlebarBuilder {
  /**
   * Create a titlebar builder
   * @param {Object} options - Configuration
   * @param {string} options.title - Initial title text
   * @param {HTMLIFrameElement} options.iframe - Target iframe for navigation
   * @param {Function} options.onDestroy - Callback for close button
   * @param {Function} options.onMinimize - Callback for minimize button
   * @param {Function} options.onSolo - Callback for solo button
   * @param {Function} options.onMute - Callback for mute button
   * @param {boolean} options.isCurrentTabSoloed - Initial solo state
   * @param {boolean} options.isCurrentTabMuted - Initial mute state
   */
  constructor(options) {
    this.title = options.title || 'Quick Tab';
    this.iframe = options.iframe;
    this.onDestroy = options.onDestroy;
    this.onMinimize = options.onMinimize;
    this.onSolo = options.onSolo;
    this.onMute = options.onMute;
    this.isCurrentTabSoloed = options.isCurrentTabSoloed || false;
    this.isCurrentTabMuted = options.isCurrentTabMuted || false;
  }

  /**
   * Build the titlebar element
   * @returns {HTMLElement} The complete titlebar
   */
  build() {
    const titlebar = this._createContainer();

    const leftSection = this._createLeftSection();
    titlebar.appendChild(leftSection);

    const controls = this._createControls();
    titlebar.appendChild(controls);

    return titlebar;
  }

  /**
   * Create titlebar container
   * @private
   */
  _createContainer() {
    return createElement('div', {
      className: 'quick-tab-titlebar',
      style: {
        height: '40px',
        backgroundColor: '#2d2d2d',
        borderBottom: '1px solid #444',
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'space-between',
        padding: '0 12px',
        cursor: 'move',
        userSelect: 'none'
      }
    });
  }

  /**
   * Create left section with navigation and title
   * @private
   */
  _createLeftSection() {
    const leftSection = createElement('div', {
      style: {
        display: 'flex',
        alignItems: 'center',
        flex: '1',
        overflow: 'hidden',
        gap: '8px'
      }
    });

    const navContainer = this._createNavigationButtons();
    leftSection.appendChild(navContainer);

    const favicon = this._createFavicon();
    leftSection.appendChild(favicon);

    const titleText = this._createTitleText();
    leftSection.appendChild(titleText);

    return leftSection;
  }

  /**
   * Create navigation buttons (back, forward, reload, zoom)
   * @private
   */
  _createNavigationButtons() {
    const navContainer = createElement('div', {
      style: {
        display: 'flex',
        gap: '4px',
        alignItems: 'center'
      }
    });

    // Back button
    const backBtn = this._createButton(
      'â†',
      () => {
        if (this.iframe?.contentWindow) {
          try {
            this.iframe.contentWindow.history.back();
          } catch (err) {
            console.warn(
              '[TitlebarBuilder] Cannot navigate back - cross-origin'
            );
          }
        }
      },
      'Back'
    );
    navContainer.appendChild(backBtn);

    // Forward button
    const forwardBtn = this._createButton(
      'â†’',
      () => {
        if (this.iframe?.contentWindow) {
          try {
            this.iframe.contentWindow.history.forward();
          } catch (err) {
            console.warn(
              '[TitlebarBuilder] Cannot navigate forward - cross-origin'
            );
          }
        }
      },
      'Forward'
    );
    navContainer.appendChild(forwardBtn);

    // Reload button
    const reloadBtn = this._createButton(
      'â†»',
      () => {
        if (this.iframe) {
          const currentSrc = this.iframe.src;
          this.iframe.src = 'about:blank';
          setTimeout(() => {
            this.iframe.src = currentSrc;
          }, 10);
        }
      },
      'Reload'
    );
    navContainer.appendChild(reloadBtn);

    // Zoom controls
    this._addZoomControls(navContainer);

    return navContainer;
  }

  /**
   * Add zoom controls to navigation container
   * @private
   */
  _addZoomControls(container) {
    let currentZoom = 100;

    const zoomOutBtn = this._createButton(
      'âˆ’',
      () => {
        if (currentZoom > 50) {
          currentZoom -= 10;
          this._applyZoom(currentZoom, zoomDisplay);
        }
      },
      'Zoom Out'
    );
    container.appendChild(zoomOutBtn);

    const zoomDisplay = createElement(
      'span',
      {
        style: {
          fontSize: '11px',
          color: '#fff',
          minWidth: '38px',
          textAlign: 'center',
          fontWeight: '500'
        }
      },
      '100%'
    );
    container.appendChild(zoomDisplay);

    const zoomInBtn = this._createButton(
      '+',
      () => {
        if (currentZoom < 200) {
          currentZoom += 10;
          this._applyZoom(currentZoom, zoomDisplay);
        }
      },
      'Zoom In'
    );
    container.appendChild(zoomInBtn);
  }

  /**
   * Apply zoom to iframe
   * @private
   */
  _applyZoom(zoom, display) {
    if (this.iframe) {
      const scale = zoom / 100;
      this.iframe.style.transform = `scale(${scale})`;
      this.iframe.style.transformOrigin = '0 0';
      this.iframe.style.width = `${100 / scale}%`;
      this.iframe.style.height = `${100 / scale}%`;
      display.textContent = `${zoom}%`;
    }
  }

  /**
   * Create favicon element
   * @private
   */
  _createFavicon() {
    return createElement('img', {
      className: 'quick-tab-favicon',
      style: {
        width: '16px',
        height: '16px',
        flexShrink: '0'
      },
      src: 'icons/icon-48.png'
    });
  }

  /**
   * Create title text element
   * @private
   */
  _createTitleText() {
    return createElement(
      'div',
      {
        className: 'quick-tab-title',
        style: {
          color: '#fff',
          fontSize: '14px',
          fontWeight: 'bold',
          overflow: 'hidden',
          textOverflow: 'ellipsis',
          whiteSpace: 'nowrap',
          flex: '1'
        }
      },
      this.title
    );
  }

  /**
   * Create control buttons (open, solo, mute, minimize, close)
   * @private
   */
  _createControls() {
    const controls = createElement('div', {
      style: {
        display: 'flex',
        gap: '8px'
      }
    });

    // Open in new tab button
    const openBtn = this._createButton(
      'ðŸ”—',
      () => {
        const currentSrc =
          this.iframe?.src || this.iframe?.getAttribute('data-deferred-src');
        if (currentSrc) {
          browser.runtime.sendMessage({
            action: 'openTab',
            url: currentSrc,
            switchFocus: true
          });
        }
      },
      'Open in New Tab'
    );
    controls.appendChild(openBtn);

    // Solo button
    const soloIcon = this.isCurrentTabSoloed ? 'ðŸŽ¯' : 'â­•';
    const soloBtn = this._createButton(
      soloIcon,
      () => {
        if (this.onSolo) {
          this.onSolo(soloBtn);
        }
      },
      this.isCurrentTabSoloed
        ? 'Un-solo (show on all tabs)'
        : 'Solo (show only on this tab)'
    );
    soloBtn.setAttribute('data-solo-btn', 'true');
    controls.appendChild(soloBtn);

    // Mute button
    const muteIcon = this.isCurrentTabMuted ? 'ðŸ”‡' : 'ðŸ”Š';
    const muteBtn = this._createButton(
      muteIcon,
      () => {
        if (this.onMute) {
          this.onMute(muteBtn);
        }
      },
      this.isCurrentTabMuted
        ? 'Un-mute (show on this tab)'
        : 'Mute (hide on this tab)'
    );
    muteBtn.setAttribute('data-mute-btn', 'true');
    controls.appendChild(muteBtn);

    // Minimize button
    const minimizeBtn = this._createButton(
      'âˆ’',
      () => {
        if (this.onMinimize) {
          this.onMinimize();
        }
      },
      'Minimize'
    );
    controls.appendChild(minimizeBtn);

    // Close button
    const closeBtn = this._createButton(
      'Ã—',
      () => {
        if (this.onDestroy) {
          this.onDestroy();
        }
      },
      'Close'
    );
    closeBtn.style.fontSize = '24px';
    controls.appendChild(closeBtn);

    return controls;
  }

  /**
   * Create a button element
   * @private
   */
  _createButton(text, onClick, title) {
    const button = createElement(
      'button',
      {
        className: 'quick-tab-button',
        style: {
          background: 'rgba(255, 255, 255, 0.1)',
          border: 'none',
          borderRadius: '4px',
          color: '#fff',
          cursor: 'pointer',
          fontSize: '16px',
          padding: '4px 8px',
          transition: 'background 0.2s'
        }
      },
      text
    );

    if (title) {
      button.title = title;
    }

    if (onClick) {
      button.addEventListener('click', e => {
        e.stopPropagation();
        onClick();
      });
    }

    // Hover effect
    button.addEventListener('mouseenter', () => {
      button.style.background = 'rgba(255, 255, 255, 0.2)';
    });

    button.addEventListener('mouseleave', () => {
      button.style.background = 'rgba(255, 255, 255, 0.1)';
    });

    return button;
  }
}
```

**Update window.js:**

Replace the `createTitlebar()` method:

```javascript
// OLD: Delete entire createTitlebar() method (157 lines)

// NEW: Replace with builder pattern
createTitlebar() {
  const builder = new TitlebarBuilder({
    title: this.title,
    iframe: this.iframe,
    onDestroy: () => this.onDestroy(this.id),
    onMinimize: () => this.onMinimize(this.id),
    onSolo: (btn) => this.toggleSolo(btn),
    onMute: (btn) => this.toggleMute(btn),
    isCurrentTabSoloed: this.isCurrentTabSoloed(),
    isCurrentTabMuted: this.isCurrentTabMuted()
  });

  return builder.build();
}
```

**Expected Result:**

- window.js: -157 lines (createTitlebar reduced to ~10 lines)
- TitlebarBuilder.js: ~300 lines, cc<6 for each method
- Tests: Add 15+ tests for TitlebarBuilder methods
- ESLint warnings: -1 (max-lines-per-function warning gone)

**Verification:**

```bash
# Create tests
touch tests/unit/window/TitlebarBuilder.test.js

# Build and test
npm run build && npm test

# Check ESLint
npx eslint src/features/quick-tabs/window.js
# Should not have max-lines-per-function warning for createTitlebar

wc -l src/features/quick-tabs/window.js
# Should be ~730 lines (was 880, -150 from titlebar)
```

---

### Task 5: Extract WindowStyler Component (Optional, 30min-1hr)

**Problem:** window.js has scattered styling logic for dark mode, themes,
animations

**Solution:** Create WindowStyler class to centralize styling

**Create:** `src/features/quick-tabs/window/WindowStyler.js`

This is lower priority - only do if you have extra time after Tasks 3-4.

---

### Task 6: Add WindowFactory (Optional, 30min-1hr)

**Problem:** QuickTabWindow constructor has many parameters

**Solution:** Implement factory pattern for cleaner instantiation

**Create:** `src/features/quick-tabs/window/WindowFactory.js`

This is lowest priority - nice to have but not critical.

---

## ðŸ“ Path B: Phase 2.10 Tasks

### Task 1: Extract ManagerPanelUI (2-3 hours)

**Current State:**

- Minimized tabs manager panel logic is in
  `src/features/quick-tabs/minimized-manager.js` or `panel.js`
- Likely 200+ lines of DOM creation and event handling

**Create:** `src/features/quick-tabs/manager/ManagerPanelUI.js`

Extract the minimized Quick Tab manager interface that shows when tabs are
minimized.

**Expected Result:**

- ManagerPanelUI.js: 150-200 lines, cc<6
- Original file: -150 lines

---

### Task 2: Extract NavigationBar Component (1-2 hours)

**Problem:** Navigation bar (back/forward/reload buttons) is part of
TitlebarBuilder but could be standalone

**Solution:** Extract into separate component for reusability

**Create:** `src/features/quick-tabs/window/NavigationBar.js`

This could be done AFTER TitlebarBuilder is created, or you could extract it
first and use it IN TitlebarBuilder.

**Expected Result:**

- NavigationBar.js: 100-120 lines, cc<6
- TitlebarBuilder.js: -80 lines (use NavigationBar instead)

---

## ðŸ“ Path C: Phase 4 Tasks (Content Script)

See
`docs/manual/1.5.9 docs/copy-url-on-hover-refactoring-plan-v2-evidence-based.md`
for complete Phase 4 plan.

**High-level:**

1. Extract SiteHandlerRegistry (2 hours)
2. Extract site handlers (Twitter, Reddit, GitHub, Generic) (2-3 hours)
3. Extract NotificationRenderer (2 hours)
4. Extract AnimationController (1 hour)
5. Extract KeyboardShortcuts with Command pattern (2 hours)

**Total:** 8-12 hours

---

## âœ… Success Criteria

### For Path A (Phase 2.9 Complete):

- [ ] DragController integrated into window.js
- [ ] Old drag logic removed from window.js
- [ ] window.js: ~730 lines (was 880, -150 total)
- [ ] TitlebarBuilder extracted
- [ ] ESLint warnings: â‰¤15 (from 16, -1 max-lines warning)
- [ ] Tests: 542+/542+ passing (may add TitlebarBuilder tests)
- [ ] Build: Successful

### For Path B (Phase 2.10 Progress):

- [ ] ManagerPanelUI extracted
- [ ] NavigationBar extracted
- [ ] Tests: Add 25+ tests for new components
- [ ] Build: Successful

### For Path C (Phase 4 Start):

- [ ] SiteHandlerRegistry created
- [ ] 2+ site handlers extracted
- [ ] content.js: -400 lines
- [ ] Tests: Add 30+ tests
- [ ] Build: Successful

---

## ðŸš¨ Critical: What NOT to Do

### âŒ DON'T Skip Testing

Always run tests after each change:

```bash
npm run build && npm test
```

### âŒ DON'T Break Existing Functionality

Every extraction must maintain 100% backward compatibility.

### âŒ DON'T Mix Concerns

Keep concerns separated:

- Controllers = coordination logic
- Builders = DOM creation
- Handlers = business logic

---

## ðŸ“Š Reference: Current State

**ESLint Status:**

- Total errors: 57
- Total warnings: 21
- window.js: 1 warning (max-lines-per-function for createTitlebar)

**Line Counts:**

- background.js: 1126 lines
- content.js: ~3000 lines (Phase 4 target)
- window.js: 880 lines (Phase 2.9 target â†’ ~730 after tasks 3-4)

**Test Status:**

- Total tests: 542
- Test suites: 20
- All passing: âœ…
- New DragController tests: 20

---

## ðŸ§ª Testing Workflow

After EACH task:

```bash
# 1. Build
npm run build
# Expected: Successful build

# 2. Lint changed files
npx eslint src/features/quick-tabs/window.js 2>&1 | tail -20
# Expected: No new errors

# 3. Test
npm test
# Expected: All tests passing

# 4. Check line count
wc -l src/features/quick-tabs/window.js
# Expected: Decreasing line count
```

---

## ðŸ“š Context Documents

**Must Read:**

1. This document (you're reading it!)
2. `docs/misc/v1.6.0-REFACTORING-MASTER-CHECKLIST.md` - Update progress when
   done
3. `.github/copilot-instructions.md` - Robust Solutions Philosophy

**Phase-Specific Context:**

- `PHASE-3.2-COMPLETION-REPORT.md` - Previous session's work
- `docs/manual/1.5.9 docs/copy-url-on-hover-refactoring-plan-v2-evidence-based.md` -
  Overall plan

---

## ðŸ’¡ Quick Commands Reference

```bash
# Count lines in window.js
wc -l src/features/quick-tabs/window.js

# Check window.js complexity
npx eslint src/features/quick-tabs/window.js 2>&1 | grep -E "(complexity|max-lines|max-depth)"

# Build and test in one command
npm run build && npm test

# Run specific test file
npm test -- tests/unit/window/DragController.test.js

# Check all ESLint errors/warnings
npx eslint . 2>&1 | grep "problems"
```

---

## ðŸŽ¯ What Success Looks Like

### Path A Success (Phase 2.9 Complete):

- window.js is simpler and more maintainable
- DragController integrated smoothly
- TitlebarBuilder extracted cleanly
- All drag behavior works identically to before
- Ready for Phase 2.10 or Phase 4

### Path B Success (Phase 2.10 Progress):

- ManagerPanelUI isolated and testable
- NavigationBar reusable across components
- UI components well-organized
- Ready for Phase 4

### Path C Success (Phase 4 Start):

- content.js reduced by 15%+
- Site handlers testable independently
- Foundation for complete content script refactor

---

## ðŸ“ˆ Tracking Your Progress

### Before You Start:

Record baseline:

```bash
wc -l src/features/quick-tabs/window.js
# Output: 880 src/features/quick-tabs/window.js

npx eslint . 2>&1 | grep "problems"
# Output: 57 errors, 21 warnings

npm test 2>&1 | grep "Tests:"
# Output: 542 passed
```

### When Done:

Update `docs/misc/v1.6.0-REFACTORING-MASTER-CHECKLIST.md`:

1. Mark completed tasks as [x]
2. Update "Last Updated" date
3. Update Phase 2.9 progress percentage
4. Update overall progress percentage (should be ~60% after Phase 2.9 complete)
5. Update ESLint counts if changed
6. Update test counts

**Example update:**

```markdown
### Phase 2.9: Window Component Integration âœ… COMPLETE (100%)

#### QuickTabWindow Refactor

- [x] **Integrate ResizeController** - Completed
- [x] **Extract DragController** - Completed
- [x] **Integrate DragController into window.js** - Completed this session
- [x] **Create TitlebarBuilder component** - Extracted 157 lines into dedicated
      component
```

And update progress table:

```markdown
| Phase 2.9: Window Components | âœ… Complete | 100% | All controllers
integrated, TitlebarBuilder extracted |
```

And overall progress:

```markdown
**Overall Progress: ~60%** (updated 2025-11-19 session 3)
```

---

## ðŸš€ Why This Matters

**Path A (Window Components):**

- **Before:** All UI logic mixed in window.js (880 lines, hard to test)
- **After:** Separated controllers (Drag, Resize) and builders (Titlebar)
- **Impact:** Each component independently testable, cc<6 everywhere

**Path B (Quick Tabs Completion):**

- **Before:** Manager panel mixed with main component logic
- **After:** Standalone ManagerPanelUI, reusable NavigationBar
- **Impact:** Better separation of concerns, easier to modify UI

**Path C (Content Script):**

- **Before:** 100+ site handlers in if-else chains, impossible to test
- **After:** Registry pattern with isolated handlers
- **Impact:** Each handler testable independently, easy to add new sites

---

## ðŸŽ‰ Final Notes

### You're Making Great Progress!

Phase 2.9 is 50% done with DragController completed. The foundation is solid:

- 542 tests passing
- Build successful
- Zero ESLint errors in new code
- All components follow cc<6 rule

### Choose Your Adventure:

1. **Quick Win:** Complete Phase 2.9 (2-3 hours) - Integrate DragController and
   extract TitlebarBuilder
2. **Feature Complete:** Start Phase 2.10 (4-5 hours) - Extract UI components
3. **Big Impact:** Start Phase 4 (8-12 hours) - Tackle content.js monolith

All paths are valuable. Choose based on:

- **Available time:** Path A = 2-3 hours, Path B = 4-5 hours, Path C = 8-12
  hours
- **Impact:** Path A = incremental, Path B = moderate, Path C = transformative
- **Complexity:** Path A = low, Path B = medium, Path C = high

### Keep These Principles:

1. âœ… **Extract one component at a time**
2. âœ… **Test after each extraction**
3. âœ… **Maintain functionality**
4. âœ… **Document what you extract**
5. âœ… **Update master checklist when done**

### When You're Done:

Create your own `v1.6.0-REFACTORING-PHASE3.5-NEXT-STEPS.md` (or appropriate
phase number) with:

- What you completed
- What remains
- Current test/build/ESLint status
- Instructions for next agent

**Good luck! The codebase is getting better with each refactoring! ðŸš€**

---

## Contact / Questions

If stuck:

1. Check that build succeeds before testing
2. Review DragController pattern (tests/unit/window/DragController.test.js)
3. Review TitlebarBuilder example code above
4. Check ESLint output for specific errors
5. Don't hesitate to document issues for next agent

**Remember:** Progress > Perfection. Get components working, document issues,
then optimize!
