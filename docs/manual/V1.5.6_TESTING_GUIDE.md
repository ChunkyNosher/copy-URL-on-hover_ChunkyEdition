# Testing Guide for v1.5.6 - Pointer Events Integration

## Overview

Version 1.5.6 introduces Pointer Events API for Quick Tab drag/resize operations and fixes the slot number reset bug in debug mode. This guide provides comprehensive testing procedures to validate all changes.

## Critical Changes to Test

1. **Pointer Events API Integration** - Drag/resize without slipping
2. **Slot Number Reset** - Slots reset when all Quick Tabs closed
3. **Tab Switch Handling** - Emergency saves during tab switches
4. **Cross-Domain Sync** - Position persistence across different domains
5. **Touch/Pen Support** - Pointer Events unifies all input types

---

## Test Environment Setup

### Prerequisites
- Firefox or Zen Browser (latest version)
- Extension loaded from `about:debugging`
- Debug mode enabled in extension settings
- Multiple tabs open for testing

### Enable Debug Mode
1. Click extension icon
2. Go to "Appearance" tab
3. Check "Debug Mode"
4. Reload any open pages

You should see:
- `[POINTER]` tags in console for drag/resize events
- `[VISIBILITY]` tags for tab switches
- `[SLOTS]` tags for slot operations
- Slot numbers on Quick Tab toolbars (e.g., "Slot 1")

---

## Test Case 1: Drag Slipping Elimination

**Objective**: Verify Quick Tabs don't "slip out" from cursor during fast drags

### Steps
1. Open a Quick Tab (hover over link, press Q)
2. Click and hold on the Quick Tab title bar
3. Move mouse **very quickly** across the screen (left to right, then up and down)
4. Try to make the mouse "escape" from the Quick Tab
5. Release mouse

### Expected Results
âœ… Quick Tab follows cursor perfectly at all speeds  
âœ… Quick Tab never "jumps" or "detaches" from cursor  
âœ… Cursor remains "locked" to title bar throughout drag  
âœ… Console shows `[POINTER MOVE]` messages during drag  
âœ… Console shows `[POINTER UP] Drag ended` with final position

### What Changed
- **Before**: Mouse events could miss during fast movements, causing RAF to skip updates
- **After**: `setPointerCapture()` guarantees all pointer events reach handler

### Debug Console Output Example
```
[POINTER DOWN] Drag started - Pointer ID: 1, URL: https://example.com, Start: (100, 100)
[POINTER MOVE] Dragging - URL: https://example.com, Position: (250, 150)
[POINTER MOVE] Dragging - URL: https://example.com, Position: (600, 300)
[POINTER UP] Drag ended - URL: https://example.com, Final Position: (800, 400)
```

---

## Test Case 2: Tab Switch During Drag (Critical for Issue #51)

**Objective**: Verify position saved when user switches tabs mid-drag

### Steps
1. Open a Quick Tab in Tab 1
2. Start dragging the Quick Tab (click and hold title bar)
3. While holding mouse button, press **Ctrl+Tab** to switch to Tab 2
4. Release mouse in Tab 2
5. Switch back to Tab 1
6. Open another tab (Tab 3)

### Expected Results
âœ… `[POINTER CANCEL]` fires before tab switch  
âœ… Console shows emergency save message  
âœ… Quick Tab in Tab 1 stays at dragged position (doesn't revert)  
âœ… If Quick Tab appears in Tab 3, it's at the new position (not old position)  
âœ… No "jump back" when switching back to Tab 1

### What Changed
- **Before**: `mouseup` never fired if tab switched, position lost
- **After**: `pointercancel` explicitly fires before tab switch, triggering emergency save

### Debug Console Output Example
```
[POINTER DOWN] Drag started - Pointer ID: 1
[POINTER MOVE] Dragging - Position: (300, 200)
[VISIBILITY] Page hidden - pausing media and force-saving state
[POINTER CANCEL] Drag cancelled - URL: https://example.com, Saved Position: (300, 200)
[VISIBILITY] Emergency saved 1 Quick Tab positions before tab switch
```

---

## Test Case 3: Slot Number Reset on Esc

**Objective**: Verify slot numbers reset when all Quick Tabs are closed

### Steps (with Debug Mode enabled)
1. Open 3 Quick Tabs in sequence
2. Note their slot numbers: "Slot 1", "Slot 2", "Slot 3"
3. Press **Esc** to close all Quick Tabs
4. Open a new Quick Tab

### Expected Results
âœ… First 3 Quick Tabs labeled "Slot 1", "Slot 2", "Slot 3"  
âœ… Console shows `[SLOTS] Reset slot numbering - next Quick Tab will be Slot 1` after Esc  
âœ… New Quick Tab after Esc is labeled **"Slot 1"** (not "Slot 4")

### Steps (Alternative - Clear Storage Button)
1. Open 3 Quick Tabs
2. Click extension icon â†’ Advanced tab â†’ "Clear Quick Tabs Storage"
3. Open a new Quick Tab

### Expected Results
âœ… Console shows slot reset message  
âœ… New Quick Tab is "Slot 1" (not "Slot 4")

### What Changed
- **Before**: Slot numbers never reset, kept incrementing indefinitely
- **After**: `resetQuickTabSlots()` called in `closeAllQuickTabWindows()` and `clearQuickTabsFromStorage()`

---

## Test Case 4: Slot Numbers Persistent Across Tab Switches

**Objective**: Verify each Quick Tab maintains its slot number when switching tabs

### Steps
1. Tab 1: Open Quick Tab A â†’ labeled "Slot 1"
2. Tab 1: Open Quick Tab B â†’ labeled "Slot 2"
3. Switch to Tab 2
4. Tab 2: Note Quick Tab A and B slot numbers
5. Switch back to Tab 1
6. Note slot numbers again

### Expected Results
âœ… Quick Tab A always shows "Slot 1" in all tabs  
âœ… Quick Tab B always shows "Slot 2" in all tabs  
âœ… Slot numbers don't change when switching tabs  
âœ… Slot numbers are tied to Quick Tab ID, not tab order

### What Changed
- Slot assignment is based on quickTabId (unique per Quick Tab)
- Slot numbers are stored in Map (quickTabSlots), persists across tabs

---

## Test Case 5: Cross-Domain Quick Tab Sync

**Objective**: Verify Quick Tab positions sync across different domains

### Steps
1. Tab 1 (wikipedia.org): Open Quick Tab at position (100, 100)
2. Tab 1: Drag Quick Tab to position (500, 300)
3. Tab 2 (youtube.com): Check if Quick Tab appears
4. Tab 2: Note Quick Tab position

### Expected Results
âœ… Quick Tab appears in Tab 2 (youtube.com) within **<200ms**  
âœ… Position in Tab 2 is **(500, 300)** (not the original 100, 100)  
âœ… Console in Tab 2 shows `[Runtime] Received UPDATE_QUICK_TAB_FROM_BACKGROUND`  
âœ… Background.js console shows `[Background] Updated Quick Tab ... position: (500, 300)`

### What Changed
- **Before**: Cross-domain sync took up to 10 minutes (storage.sync delay)
- **After**: browser.runtime messaging provides <100ms sync via background script

### Debug Console Output Example (Background.js)
```
[Background] Received position update: https://example.com ID: qt_123 500 300
[Background] Updated Quick Tab qt_123 position: (500, 300)
[Background] Broadcasting to 5 tabs
```

---

## Test Case 6: Resize from All Directions

**Objective**: Verify resize works smoothly from all 8 handles

### Steps
1. Open a Quick Tab
2. Resize from each handle:
   - **Corners**: NE, NW, SE, SW
   - **Edges**: N, S, E, W
3. For each handle, drag **very fast** to test pointer capture
4. During resize, press **Ctrl+Tab** to test pointercancel

### Expected Results
âœ… All 8 handles work correctly  
âœ… No "escape" or "slip out" during fast resize  
âœ… Minimum size constraints respected (300x200)  
âœ… `[POINTER MOVE] Resizing` messages in console  
âœ… If tab switched during resize, `[POINTER CANCEL] Resize cancelled` fires  
âœ… Final size persists across tabs

---

## Test Case 7: Touch Input Support (If Available)

**Objective**: Verify Pointer Events supports touch devices

### Prerequisites
- Touch-enabled device or browser dev tools touch emulation
- Enable touch emulation: F12 â†’ Device Toolbar (Ctrl+Shift+M)

### Steps
1. Open Quick Tab
2. Use touch to drag title bar
3. Use touch to resize from corners

### Expected Results
âœ… Drag works with touch (same as mouse)  
âœ… Resize works with touch  
âœ… Console shows `e.pointerType === 'touch'` in debug logs (if implemented)  
âœ… No additional code needed - Pointer Events handles it automatically

---

## Test Case 8: Multiple Quick Tabs Independence

**Objective**: Verify moving one Quick Tab doesn't affect others

### Steps
1. Open Quick Tab 1, Quick Tab 2, Quick Tab 3
2. Note their positions
3. Drag Quick Tab 1 to a new position
4. Check positions of Quick Tab 2 and Quick Tab 3

### Expected Results
âœ… Quick Tab 2 and 3 remain at original positions  
âœ… Only Quick Tab 1 moves  
âœ… Background.js shows only Quick Tab 1 update  
âœ… `globalQuickTabState` in background maintains all 3 tabs

---

## Test Case 9: Regression Tests

**Objective**: Ensure existing functionality still works

### Quick Tab Creation
âœ… Press Q while hovering over link â†’ Quick Tab opens  
âœ… Quick Tab displays correct URL  
âœ… Quick Tab navigation controls work (back, forward, reload)

### Quick Tab Controls
âœ… Pin button works (ðŸ“)  
âœ… Minimize button works (âˆ’)  
âœ… Open in new tab button works (ðŸ”—)  
âœ… Close button works (âœ•)

### Persistence
âœ… Quick Tabs persist when switching tabs (same domain)  
âœ… Quick Tabs persist when switching tabs (different domain)  
âœ… Quick Tabs restore after browser restart (if storage.sync enabled)

### Storage
âœ… "Clear Quick Tabs Storage" button works  
âœ… Quick Tabs are removed from all tabs when cleared  
âœ… Slot numbers reset after clearing

---

## Performance Tests

### Test Case 10: High-Speed Dragging

**Objective**: Measure performance during rapid movements

### Steps
1. Open Quick Tab
2. Drag continuously at maximum speed for 10 seconds
3. Monitor console for performance issues

### Expected Results
âœ… No lag or stuttering  
âœ… Position updates appear smooth (60fps)  
âœ… No memory leaks (check Task Manager)  
âœ… CPU usage reasonable (<10% for extension process)

### What Changed
- **Before**: RAF introduced 16ms delay per frame
- **After**: Direct DOM updates (1-2ms latency)

---

## Debug Mode Console Verification

### Expected Log Patterns

**Drag Operation:**
```
[POINTER DOWN] Drag started - Pointer ID: 1, URL: https://..., Start: (x, y)
[POINTER MOVE] Dragging - URL: https://..., Position: (x, y)
[POINTER MOVE] Dragging - URL: https://..., Position: (x, y)
[POINTER UP] Drag ended - URL: https://..., Final Position: (x, y)
```

**Resize Operation:**
```
[POINTER DOWN] Resize started - Direction: se, URL: https://..., Start Size: WxH
[POINTER MOVE] Resizing - URL: https://..., Size: WxH, Position: (x, y)
[POINTER UP] Resize ended - URL: https://..., Final Size: WxH
```

**Tab Switch During Drag:**
```
[POINTER CANCEL] Drag cancelled - URL: https://..., Saved Position: (x, y)
[VISIBILITY] Page hidden - pausing media and force-saving state
[VISIBILITY] Emergency saved N Quick Tab positions before tab switch
```

**Slot Operations:**
```
[SLOTS] Reset slot numbering - next Quick Tab will be Slot 1
```

**Cleanup:**
```
[CLEANUP] Drag event listeners removed
[CLEANUP] Resize event listeners removed
```

---

## Known Issues to Test For

### Issue #51 Scenarios (Should be FIXED)
âŒ **Before v1.5.6**: Quick Tabs jump to original position when switching tabs  
âœ… **After v1.5.6**: Quick Tabs maintain position across tab switches

âŒ **Before**: Position lost if tab switched during drag  
âœ… **After**: Position saved via pointercancel emergency save

âŒ **Before**: Drag slipping during fast movements  
âœ… **After**: setPointerCapture prevents slipping

### Slot Number Bug (Should be FIXED)
âŒ **Before v1.5.6**: Slot 4, 5, 6... after closing all tabs  
âœ… **After v1.5.6**: Slot 1 after closing all tabs

---

## Browser Compatibility

### Firefox
âœ… Pointer Events API supported since Firefox 38 (2015)  
âœ… setPointerCapture supported since Firefox 59  
âœ… All Pointer Events work correctly

### Zen Browser
âœ… Based on Firefox, full Pointer Events support  
âœ… All features work identically to Firefox

---

## Reporting Issues

If any test case fails, report:
1. Browser version
2. Extension version (1.5.6)
3. Steps to reproduce
4. Expected vs actual behavior
5. Console logs (with Debug Mode enabled)
6. Screenshot/video if visual issue

---

## Success Criteria

All test cases should pass:
- âœ… Drag slipping eliminated (Test Case 1)
- âœ… Tab switch during drag handled (Test Case 2)
- âœ… Slot numbers reset on Esc/Clear Storage (Test Case 3)
- âœ… Slot numbers persistent across tabs (Test Case 4)
- âœ… Cross-domain sync <200ms (Test Case 5)
- âœ… All 8 resize handles work (Test Case 6)
- âœ… Touch input supported (Test Case 7)
- âœ… Multiple Quick Tabs independent (Test Case 8)
- âœ… No regressions (Test Case 9)
- âœ… Performance acceptable (Test Case 10)

**Target**: 95%+ reliability for all Issue #51 scenarios.

---

**Version**: 1.5.6  
**Date**: 2025-11-11  
**Author**: feature-optimizer agent
