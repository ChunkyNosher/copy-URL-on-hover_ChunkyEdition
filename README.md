# Firefox Extension: Copy URL on Hover

**Version 1.5.8.7** - A feature-rich Firefox/Zen Browser extension with modular architecture for quick URL copying and advanced Quick Tab management with Firefox Container support and Floating Panel Manager.

This is a complete, customizable Firefox extension that allows you to copy URLs or link text by pressing keyboard shortcuts while hovering over links, plus powerful Quick Tabs for browsing links in floating, draggable iframe windows. Now with full Firefox Container integration and a floating Quick Tabs Manager panel that works in Zen Browser.

## üìÅ Repository Structure (v1.5.8.7 - Modular Architecture with Enhanced Debugging)

**Source Files (New Modular Structure)**:

- **`src/`** - Modular source code
  - **`src/core/`** - Core modules (config.js, state.js, events.js)
  - **`src/features/`** - Feature modules
    - **`src/features/url-handlers/`** - 11 categorized URL handler modules (104 handlers total)
  - **`src/utils/`** - Utility modules (debug.js, dom.js, browser-api.js)
  - **`src/content.js`** - Main entry point
- **`dist/`** - Built/bundled files (generated by `npm run build`)
- **Legacy Files**: `manifest.json`, `background.js`, `popup.html`, `popup.js`, `state-manager.js`
- **Sidebar**: `sidebar/quick-tabs-manager.html`, `sidebar/quick-tabs-manager.js`, `sidebar/quick-tabs-manager.css`
- **Build System**: `package.json`, `rollup.config.js`
- **Documentation**: `/docs/` folder organized by type:
  - `/docs/changelogs/` - Version changelogs
  - `/docs/implementation-summaries/` - Feature implementation notes
  - `/docs/security-summaries/` - Security audit reports
  - `/docs/manual/` - Guides and architecture documentation (including `modular-architecture-refactor.md`)

## ‚ú® Key Features

### Core Features

‚úì **Quick URL Copying** - Press keyboard shortcuts while hovering over links  
‚úì **Quick Tabs** - Floating, draggable, resizable iframe windows with full navigation  
‚úì **Firefox Container Support (v1.5.7)** - Quick Tabs isolated by Firefox Container  
‚úì **Floating Quick Tabs Manager (NEW v1.5.8.1)** - Persistent, draggable panel for managing all Quick Tabs  
‚úì **Cross-Tab Sync** - Quick Tabs persist across all browser tabs (BroadcastChannel + browser.storage)  
‚úì **Z-Index Management (v1.5.7)** - Multiple Quick Tabs layer correctly based on interaction  
‚úì **Pin to Page** - Pin Quick Tabs to specific pages  
‚úì **Auto-Updates** - Automatic extension updates via GitHub releases  
‚úì **100+ Site Handlers** - Optimized for popular websites  
‚úì **Debug Mode** - Slot number tracking and enhanced logging  
‚úì **Dark Mode** - Full dark theme support

### Quick Tabs Manager Floating Panel (v1.5.8.1)

‚úì **NEW**: Persistent Floating Panel - Works in Zen Browser where sidebar is disabled  
‚úì **NEW**: Draggable & Resizable - Move and resize from any edge or corner  
‚úì **NEW**: Position Memory - Panel remembers position and size across sessions  
‚úì Container Categorization - Quick Tabs grouped by Firefox Container  
‚úì Action Buttons - "Close Minimized" and "Close All" buttons  
‚úì Go to Tab - Jump to the browser tab containing a Quick Tab  
‚úì Keyboard Shortcut - Press `Ctrl+Alt+Z` (or `Cmd+Option+Z` on Mac) to toggle panel  
‚úì Real-time Updates - Panel auto-refreshes as Quick Tabs change  
‚úì Visual Indicators - Green (active) and Yellow (minimized) status dots  
‚úì Persistent State - Survives page navigation and browser restarts

### Quick Tabs Features

‚úì **Firefox Container Integration** - Quick Tabs respect container boundaries  
‚úì **Smart Z-Index Management** - Most recently interacted tab always on top  
‚úì Navigation controls (back, forward, reload, open in new tab)  
‚úì Pointer Events API for drag/resize (eliminates drag slipping)  
‚úì Tab switch handling during drag (pointercancel event)  
‚úì Slot numbers reset when all Quick Tabs closed  
‚úì Drag to move with setPointerCapture (no escape at high speeds)  
‚úì Resize from any edge/corner with pointer capture  
‚úì Minimize to sidebar manager  
‚úì Pin tabs to specific pages  
‚úì Multiple instances with unique ID tracking  
‚úì Slot number labels in debug mode (persistent across tabs)

### Modern API Framework (v1.5.8.1)

- **Floating Panel Injection** - Content script injects persistent panel into page DOM
- **Pointer Events API** - Reliable drag/resize with setPointerCapture
- **Firefox Container API** - Container-aware state management with `contextualIdentities`
- **browser.storage.sync** - Container-keyed persistent storage
- **browser.storage.local** - Panel position and size persistence
- **browser.storage.session** - Fast ephemeral state (Firefox 115+)
- **BroadcastChannel** - Real-time same-origin sync with container filtering
- **Runtime Messaging** - Cross-origin sync via background script
- **ID-based Tracking** - Prevents duplicate instance conflicts
- **Commands API** - Keyboard shortcuts for panel toggle (Ctrl+Alt+Z)

### What's New in v1.5.8.7?

‚úÖ **Enhanced Code Quality Infrastructure**

- Added comprehensive GitHub Actions workflows for code quality checks
- Integrated DeepSource for advanced static analysis and security scanning
- Added ESLint, Prettier, and Jest configurations for better code consistency
- CodeQL security analysis for vulnerability detection
- Automated test coverage tracking with Codecov
- Web extension validation with Mozilla's web-ext tool
- All workflows optimized to work with GitHub Copilot for enhanced code reviews

‚úÖ **Improved Debugging Capabilities**

- Added aggressive logging throughout initialization process
- Enhanced error handling with detailed error messages
- Global error handlers for unhandled exceptions and promise rejections
- Defensive fallbacks in ConfigManager for robust configuration loading
- Debug markers to verify script execution at critical points
- Comprehensive debugging guide added to README
- Build validation checks to prevent ES6 import/export issues

‚úÖ **Better Development Experience**

- Created barrel files (index.js) for cleaner module imports
- Enhanced build process with bundle integrity validation
- Improved CI/CD pipeline with sanity checks
- Better error messages for troubleshooting
- Development-focused documentation updates

### What's New in v1.5.8.2?

‚úÖ **Modular Architecture Refactoring**

- Complete refactoring of content.js from monolithic 180KB file to modular structure
- URL handlers extracted into 11 categorized modules (social-media, video, developer, blogging, ecommerce, image-design, news-discussion, entertainment, gaming, learning, other)
- Core functionality separated into reusable modules (config, state, events, utilities)
- Build system using Rollup for optimized bundling
- Reduced bundled content.js to 63KB (65% size reduction!)
- Improved maintainability and code organization
- Easier for developers to contribute and extend functionality
- All 104 URL handler functions preserved and working
- Foundation for future feature additions without bloating core code

### What's New in v1.5.8.1?

‚úÖ **Floating Quick Tabs Manager Panel**

- Replaced Firefox sidebar with persistent floating panel
- Works in Zen Browser where sidebar API is disabled
- Draggable panel with Pointer Events API (no slipping!)
- Resizable from all edges and corners with min/max constraints
- Position and size persist across sessions via browser.storage.local
- Container-aware categorization with visual indicators
- Action buttons: "Close Minimized" and "Close All"
- "Go to Tab" button to switch to the tab containing a Quick Tab
- Press `Ctrl+Alt+Z` (or `Cmd+Option+Z` on Mac) to toggle panel
- Panel survives page navigation (re-injected on each page load)
- Auto-refresh every 2 seconds to stay in sync with Quick Tabs

‚úÖ **Zen Browser Compatibility**

- Extension now works fully in Zen Browser
- No dependency on Firefox Sidebar API
- Panel injected via content script for universal compatibility

## üöÄ Installation

### Easy Installation (Recommended)

1. Go to the [Releases page](https://github.com/ChunkyNosher/copy-URL-on-hover_ChunkyEdition/releases)
2. Download the latest `copy-url-hover-extension.xpi`
3. Open Firefox/Zen Browser ‚Üí `about:addons`
4. Click gear icon (‚öôÔ∏è) ‚Üí "Install Add-on From File..."
5. Select the `.xpi` file and confirm

**Auto-updates enabled** - You'll be notified when new versions are available.

### Manual Installation (Development)

1. Navigate to `about:debugging` in Firefox
2. Click "This Firefox" ‚Üí "Load Temporary Add-on"
3. Select `manifest.json` from the extension folder
4. Extension loaded! (Removed on browser restart)

## üìñ Usage

### Basic Copy Functions

1. Hover over any link
2. Press:
   - **Y** - Copy URL
   - **X** - Copy link text
   - **O** - Open in new tab
3. Notification confirms the action

### Quick Tabs

1. Hover over a link
2. Press **Q** to open Quick Tab
3. Use controls:
   - **‚Üê‚Üí** Navigate (back/forward)
   - **‚Üª** Reload
   - **üìç** Pin to current page
   - **‚àí** Minimize to sidebar
   - **üîó** Open in new tab
   - **‚úï** Close
4. **Drag** title bar to move (uses Pointer Events - no slipping!)
5. **Drag** edges/corners to resize (pointer capture for smooth resizing)
6. **Pin** to keep Quick Tab only on specific pages
7. **Press Esc** to close all Quick Tabs (slot numbers reset)

### Quick Tabs Manager Floating Panel (NEW v1.5.8.1)

1. **Press `Ctrl+Alt+Z`** (or `Cmd+Option+Z` on Mac) to open/close panel
2. Panel shows:
   - All Quick Tabs organized by Firefox Container
   - Green indicator (üü¢) for active Quick Tabs
   - Yellow indicator (üü°) for minimized Quick Tabs
   - Tab metadata (position, size, slot number)
3. **Drag** the panel header to move it anywhere on screen
4. **Resize** the panel by dragging edges or corners (min 250√ó300)
5. **Click** on any Quick Tab to:
   - **üîó Go to Tab** - Switch to the browser tab containing this Quick Tab
   - **‚ûñ Minimize** - Minimize an active Quick Tab
   - **‚Üë Restore** - Restore a minimized Quick Tab to original position
   - **‚úï Close** - Close the Quick Tab
6. **Action Buttons**:
   - **Close Minimized** - Close all minimized Quick Tabs
   - **Close All** - Close ALL Quick Tabs (active + minimized)
7. Panel updates in real-time as Quick Tabs change
8. Position and size persist across page navigation and browser restarts
9. **Press Esc** to close all Quick Tabs (slot numbers reset)

### Debug Mode

Enable in settings to see:

- **Slot numbers** on Quick Tab toolbars (e.g., "Slot 1", "Slot 2")
- Slot numbers reset when all Quick Tabs are closed (Esc or Clear Storage)
- Slot numbers stay consistent across tab switches
- Enhanced console logging with [POINTER] tags for drag/resize events

## ‚öôÔ∏è Settings

Access settings by clicking the extension icon. Organized into 4 tabs:

### Copy URL Tab

- Keyboard shortcuts for copy URL, copy text, open in new tab
- Modifier keys (Ctrl, Alt, Shift)

### Quick Tabs Tab

- Quick Tab keyboard shortcut (default: Q)
- Close all shortcut (default: Escape)
- Max windows (1-10)
- Default size and position
- Cross-tab persistence toggle
- Close on open toggle

### Appearance Tab

- Notification style (tooltip or notification)
- Colors, borders, animations
- Position and size
- Dark mode toggle
- Debug mode toggle

### Advanced Tab

- Clear Quick Tab Storage (also resets slot numbers!)
- Reset settings to defaults

## üîí Security Notice

**Manifest v2 Required**: This extension uses Manifest v2 to access the full `webRequest` API with `webRequestBlocking` permission. This allows the extension to modify X-Frame-Options and CSP headers for Quick Tabs to display any website in iframes.

**X-Frame-Options Bypass**: The extension removes X-Frame-Options and CSP frame-ancestors headers to allow Quick Tabs to display any website in iframes. This is necessary for universal compatibility but removes clickjacking protection for iframed content.

**Firefox Container Isolation (v1.5.7+)**: Quick Tabs now respect Firefox Container boundaries, providing an additional layer of isolation for sensitive browsing contexts (e.g., Banking, Work containers).

**Use at your own discretion.** Only open Quick Tabs from trusted websites or disable the extension when browsing untrusted sites.

## üêõ Known Limitations

1. **Quick Tab Focus**: Clicking inside a Quick Tab iframe captures keyboard focus. Click the main page to restore shortcuts.

2. **Nested Quick Tabs**: Only works for same-origin iframes. Use "Open in New Tab" button for cross-origin links.

3. **Zen Browser Themes**: Cannot detect Zen workspace themes (requires native API access). Use built-in dark mode instead.

4. **Manifest v2**: Extension must remain on Manifest v2 for full webRequest API functionality. Manifest v3 does not support `webRequestBlocking` which is required for header modification.

## üìö Documentation

- **Changelogs**: See `/docs/changelogs/` for version history
- **Architecture**: See `/docs/manual/quick-tab-sync-architecture.md`
- **Pointer Events Guide**: See `/docs/manual/Pointer-Events-Integration-Guide.md`
- **Testing Guide**: See `/docs/manual/TESTING_GUIDE_ISSUE_51.md`

## üîß Debugging the Extension

If the extension is not working or appears to be in a non-functional state, follow these steps to diagnose and fix the issue.

### Quick Debug Checklist

1. **Check if the content script is loading**:
   - Open any web page
   - Press **F12** or **Ctrl+Shift+J** to open the browser console
   - Look for logs starting with `[Copy-URL-on-Hover]`
   - You should see:
     ```
     [Copy-URL-on-Hover] Script loaded! @ 2025-11-13T04:05:38.690Z
     [Copy-URL-on-Hover] All module imports completed successfully
     [Copy-URL-on-Hover] ‚úì‚úì‚úì EXTENSION FULLY INITIALIZED ‚úì‚úì‚úì
     ```

2. **Test the debug marker**:
   - In the console, type: `window.CUO_debug_marker`
   - Should return: `"JS executed to top of file!"`
   - If `undefined`, the script failed to load or crashed early

3. **Check initialization status**:
   - In the console, type: `window.CUO_initialized`
   - Should return: `true`
   - If `false` or `undefined`, initialization failed

### Debugging v1.5.8.6+ (Modular Architecture)

The modular architecture (v1.5.8.6+) introduced a new build system. If the extension is not working:

#### 1. Verify Bundle Integrity

**Check for ES6 imports/exports in the built file** (these break browser loading):

```bash
# In the extension directory
grep "^import " dist/content.js
grep "^export " dist/content.js
```

- **If you see output**: The bundle is broken! ES6 modules cannot be used directly in content scripts.
- **If no output**: Bundle is correctly flattened ‚úì

#### 2. Validate Build Output

```bash
# Check bundle size (should be ~60-80KB)
ls -lh dist/content.js

# Verify key classes are present
grep "ConfigManager" dist/content.js
grep "StateManager" dist/content.js
grep "EventBus" dist/content.js
```

All `grep` commands should return matches. If not, the build is incomplete.

#### 3. Rebuild from Scratch

```bash
# Clean and rebuild
npm run clean
npm ci  # Fresh install of dependencies
npm run build:prod

# Verify the build
ls -lh dist/
```

#### 4. Check Browser Console for Errors

Open the console and look for:

- **Syntax errors**: Usually means the bundle has ES6 imports/exports
- **Module not found**: Build didn't include all dependencies
- **Undefined variables**: Missing exports or incorrect bundling

### Common Issues and Solutions

#### Issue: Extension loads but keyboard shortcuts don't work

**Symptoms**:

- Console shows successful initialization
- No errors in console
- Pressing Y/X/Q does nothing

**Solutions**:

1. **Check if page has focus**:
   - Click on the main page (not inside a Quick Tab or address bar)
   - Quick Tabs capture keyboard focus when clicked

2. **Verify shortcuts in settings**:
   - Click extension icon ‚Üí Check keyboard shortcuts
   - Make sure shortcuts aren't conflicting with page shortcuts

3. **Enable Debug Mode**:
   - Extension icon ‚Üí Advanced tab ‚Üí Enable Debug Mode
   - Check console for keyboard event logs

#### Issue: Quick Tabs not opening

**Symptoms**:

- Pressing Q does nothing
- No error messages

**Solutions**:

1. **Check Quick Tab settings**:
   - Extension icon ‚Üí Quick Tabs tab
   - Ensure "Cross-tab persistence" is enabled
   - Try adjusting max windows setting

2. **Clear Quick Tab storage**:
   - Extension icon ‚Üí Advanced tab ‚Üí Clear Quick Tab Storage
   - Try opening a Quick Tab again

3. **Check for iframe restrictions**:
   - Some sites block iframes (e.g., banks, government sites)
   - Try on a different site (e.g., Wikipedia, GitHub)

#### Issue: Extension completely broken after update

**Symptoms**:

- No console logs at all
- `window.CUO_debug_marker` is undefined
- Extension icon might be grayed out

**Solutions**:

1. **Verify installation**:
   - Go to `about:addons`
   - Check if extension is enabled
   - Check for error messages

2. **Check manifest.json**:

   ```bash
   # Verify manifest in dist/
   cat dist/manifest.json
   ```

   - Should show version 1.5.8.7 or higher
   - Should have `"manifest_version": 2`
   - Should have content_scripts pointing to `"content.js"`

3. **Reinstall the extension**:
   - Download latest .xpi from [Releases](https://github.com/ChunkyNosher/copy-URL-on-hover_ChunkyEdition/releases)
   - Uninstall old version from `about:addons`
   - Install new .xpi file

4. **Check Firefox version**:
   - Extension requires Firefox 115+ for all features
   - Some features use `browser.storage.session` (Firefox 115+)

#### Issue: Extension works but no notifications appear

**Symptoms**:

- Keyboard shortcuts work (URL is copied)
- No visual feedback

**Solutions**:

1. **Check notification settings**:
   - Extension icon ‚Üí Appearance tab
   - Ensure "Show notification" is enabled
   - Try different notification styles (tooltip vs notification)

2. **Check site CSP**:
   - Some sites block injected content via Content Security Policy
   - Try on a different site

### Advanced Debugging

#### Enable Maximum Logging

1. **Enable Debug Mode**:
   - Extension icon ‚Üí Advanced tab ‚Üí Enable Debug Mode
2. **Check all log categories**:

   ```javascript
   // In browser console
   // Shows all extension state
   window.CUO_debug_marker;
   window.CUO_initialized;

   // Force enable debug (temporary)
   localStorage.setItem('debugMode', 'true');
   ```

3. **Monitor initialization steps**:
   - Look for logs with `STEP:` prefix
   - Shows exactly where initialization stops if it fails

#### Check Storage State

```javascript
// In browser console
// Check configuration
browser.storage.local.get().then(console.log);

// Check Quick Tab state
browser.storage.sync.get('quick_tabs_state_v2').then(console.log);

// Check session state (Firefox 115+)
browser.storage.session.get().then(console.log);
```

#### Test with Minimal Content Script

If all else fails, create a minimal test:

1. **Create test file** `test-content.js`:

   ```javascript
   alert('Extension content script is running!');
   console.log('Extension test script loaded');
   ```

2. **Temporarily modify manifest.json**:

   ```json
   "content_scripts": [{
     "matches": ["<all_urls>"],
     "js": ["test-content.js"],
     "run_at": "document_idle"
   }]
   ```

3. **Reload extension** and visit any page
   - If alert appears: Extension loading works, issue is in main code
   - If no alert: Extension installation or manifest is broken

### Error Messages Reference

| Error Message                            | Meaning                    | Solution                                            |
| ---------------------------------------- | -------------------------- | --------------------------------------------------- |
| `browser.storage.local is not available` | Browser API not accessible | Check Firefox version, reload extension             |
| `import` or `export` in bundle           | Build is broken            | Rebuild: `npm run clean && npm run build:prod`      |
| `ConfigManager is not defined`           | Bundle missing classes     | Rebuild with all dependencies                       |
| `CRITICAL INITIALIZATION ERROR`          | Init failed                | Check console for specific error, rebuild if needed |
| No logs at all                           | Script not loading         | Check manifest.json, verify file paths              |

### Getting Help

If none of these steps work:

1. **Collect diagnostic info**:
   - Firefox version
   - Extension version
   - Full browser console output (copy all logs)
   - Steps to reproduce

2. **Open an issue** on GitHub with:
   - Diagnostic info from step 1
   - What you've already tried
   - Screenshots of console errors

## üõ†Ô∏è Development

### Releasing a New Version

1. Update `version` in `manifest.json`
2. Commit changes
3. Create and push git tag:
   ```bash
   git tag v1.x.x
   git push origin v1.x.x
   ```
4. GitHub Actions builds `.xpi` and creates release
5. Users receive auto-update notifications

### Testing

See `/docs/manual/TESTING_GUIDE_ISSUE_51.md` for comprehensive testing procedures.

### API Framework

**v1.5.8.1** uses modern browser APIs for optimal performance:

- **Content Script Injection** - Persistent floating panel injected into page DOM
- **Pointer Events API** (setPointerCapture) - Drag/resize without slipping
- **Firefox Container API** (contextualIdentities) - Container-aware state management
- **BroadcastChannel API** - Real-time same-origin synchronization
- **browser.runtime messaging** - Cross-origin coordination
- **browser.storage.sync** - Persistent state across devices
- **browser.storage.local** - Panel position and size persistence
- **browser.storage.session** - Fast ephemeral state (Firefox 115+)
- **Commands API** - Keyboard shortcuts (e.g., Ctrl+Alt+Z for panel toggle)

## üåê Supported Websites (100+)

Optimized handlers for:

- Social Media (Twitter/X, Reddit, LinkedIn, Instagram, Facebook, etc.)
- Video Platforms (YouTube, Vimeo, Twitch, etc.)
- Developer Platforms (GitHub, GitLab, Stack Overflow, etc.)
- E-commerce (Amazon, eBay, Etsy, etc.)
- News & Blogs (Medium, Dev.to, Hashnode, etc.)
- And many more!

**Plus generic fallback handler for any website.**

## üìù Notes

- This extension was coded by AI as a personal project
- Not affiliated with Mozilla or Firefox
- Respects Content Security Policies (won't work on restricted Mozilla pages)
- **Requires Manifest v2** for full webRequest API access

## üìÑ License

See repository for license information.

---

**Current Version**: 1.5.8.7  
**Last Updated**: 2025-11-13  
**Repository**: [ChunkyNosher/copy-URL-on-hover_ChunkyEdition](https://github.com/ChunkyNosher/copy-URL-on-hover_ChunkyEdition)
