{
  "id": "a2fe61d1-fb13-436e-a86d-ff67b82b18fa",
  "title": "v1.6.3.7-v13 Storage Validation",
  "details": "# v1.6.3.7-v13 Storage Validation and Recovery Fixes\n\n## Issue #2: Centralized Storage Write Validation\n- Created `_writeQuickTabStateWithValidation()` for all direct storage writes\n- Updated 4 functions to use centralized validation:\n  - `_writeRecoveredState()` - Recovery writes\n  - `saveMigratedQuickTabState()` - Migration writes\n  - `_cleanupQuickTabStateAfterTabClose()` - Cleanup writes\n  - `_performAdoptionStorageWrite()` - Adoption writes\n- All writes now have readback validation with structured logging\n\n## Issue #7: Storage Corruption Recovery Strategies\n- `_attemptStorageWriteRecovery()` routes to type-specific recovery:\n  - READ_RETURNED_NULL: `_recoverFromNullRead()` - clears oldest tabs (RECOVERY_KEEP_PERCENTAGE=0.75)\n  - TAB_COUNT_MISMATCH: `_recoverFromTabCountMismatch()` - re-writes state\n  - SAVEID_MISMATCH: `_recoverFromSaveIdMismatch()` - checks sequence ID ordering\n  - CHECKSUM_MISMATCH: `_recoverFromChecksumMismatch()` - re-writes with checksum verification\n- Helper functions: `_tryRecoveryWrite()`, `_tryRecoveryWriteWithTabCount()`, `_tryRecoveryWriteWithChecksum()`, `_logRecoveryFailure()`\n\n## Issue #3: Sequence ID Documentation\n- Added comprehensive inline comment to `_checkSequenceIdOrdering()` explaining:\n  - Firefox storage.onChanged has NO ordering guarantees\n  - Sequence IDs assigned at write-time provide reliable ordering\n  - 50ms timestamp window is SECONDARY fallback for legacy data\n- Enhanced out-of-order event logging\n\n## Key Constants\n- RECOVERY_KEEP_PERCENTAGE = 0.75 (keep newest 75% of tabs)\n- DEBUG_DIAGNOSTICS flag controls verbose diagnostic logging",
  "category": "implementation",
  "dateCreated": "2025-12-11T18:14:58.000Z",
  "dateUpdated": "2025-12-11T18:14:58.000Z"
}
