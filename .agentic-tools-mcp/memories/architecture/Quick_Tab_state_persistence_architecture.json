{
  "id": "dc70e6e2-4a25-4262-af7d-03f56a15d4d1",
  "title": "Quick Tab state persistence architecture",
  "content": "Quick Tab State Persistence Architecture (v1.6.0.12):\n\n**Storage Strategy:**\n- Primary: browser.storage.local (unlimited quota)\n- Fallback: browser.storage.sync (backward compatibility only)\n- Session: browser.storage.session (temporary fast access)\n\n**State Flow:**\n1. Content Script creates/updates Quick Tab → sends message to Background\n2. Background updates globalQuickTabState → saves to local storage\n3. Local storage change event → Background broadcasts to all content scripts\n4. Other content scripts receive broadcast → update their state\n\n**Critical State Properties:**\n- Position (left, top)\n- Size (width, height)\n- Z-Index (stacking order) - NEW in v1.6.0.12\n- Visibility (minimized, soloedOnTabs, mutedOnTabs)\n- Container (cookieStoreId)\n\n**Tab Switching Behavior:**\n1. Tab becomes visible → SyncCoordinator.handleTabVisible()\n2. StorageManager.loadAll() → requests from background via GET_QUICK_TABS_STATE\n3. Background returns authoritative state for container\n4. StateManager.hydrate(quickTabs) → updates local state\n5. UICoordinator renders/updates visible Quick Tabs\n\n**Key Classes:**\n- StorageManager: Load/save from storage, listen to storage changes\n- SyncCoordinator: Route broadcasts, handle tab visibility\n- StateManager: Maintain QuickTab domain entities in memory\n- UICoordinator: Render QuickTabWindow instances from QuickTab entities\n- BroadcastManager: Send messages via BroadcastChannel for cross-tab sync\n\n**Background Handlers:**\n- CREATE_QUICK_TAB, CLOSE_QUICK_TAB\n- UPDATE_QUICK_TAB_POSITION_FINAL, UPDATE_QUICK_TAB_SIZE_FINAL\n- UPDATE_QUICK_TAB_SOLO, UPDATE_QUICK_TAB_MUTE, UPDATE_QUICK_TAB_MINIMIZE\n- UPDATE_QUICK_TAB_ZINDEX (NEW in v1.6.0.12)\n- GET_QUICK_TABS_STATE (authoritative state source)",
  "metadata": {},
  "createdAt": "2025-11-21T07:17:32.572Z",
  "updatedAt": "2025-11-21T07:17:32.572Z",
  "category": "architecture"
}
