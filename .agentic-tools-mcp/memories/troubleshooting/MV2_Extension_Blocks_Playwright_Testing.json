{
  "id": "138d4253-4fde-47b7-8cdb-49875b7aee11",
  "title": "MV2 Extension Blocks Playwright Testing",
  "details": "## Critical Testing Blocker Discovered\n\n**Issue:** Cannot test Manifest V2 Firefox extension with Playwright due to Chromium compatibility.\n\n**Root Cause:**\n- Extension is Manifest V2 with persistent background page (`manifest_version: 2`, `background.scripts`, `persistent: true`)\n- Chromium (Playwright's bundled browser) removed support for Manifest V2 extensions\n- Playwright docs confirm: \"Background pages have been removed from Chromium together with Manifest V2 extensions\"\n\n**Why This Blocks Testing:**\n- Playwright expects service workers (MV3) but extension uses persistent background page (MV2)\n- Extension doesn't load in Chromium, so test bridge is never injected\n- Tests time out waiting for `window.__COPILOT_TEST_BRIDGE__`\n\n**Solutions (in priority order):**\n\n1. **Migrate extension to Manifest V3** (Recommended)\n   - Convert persistent background page to service worker\n   - Update message passing for MV3 architecture\n   - Test with Playwright Chrome after migration\n   - Benefit: Modern, future-proof, testable\n\n2. **Use Firefox with playwright-webextext library**\n   - Install: `npm install playwright-webextext`\n   - Use `withExtension(firefox, pathToExtension)` wrapper\n   - Requires headed mode (headless: false) + xvfb-run in CI\n   - Complexity: Medium, Firefox-only solution\n\n3. **Manual testing only**\n   - Skip automated Playwright tests for now\n   - Test manually in Firefox during development\n   - Not ideal for CI/CD pipelines\n\n**Current State:**\n- Test bridge is properly built and injected\n- Headless mode configured correctly (Chrome 109+ new headless)\n- Extension loading fails at browser level due to MV2/MV3 mismatch\n\n**Next Steps:**\nEither migrate to MV3 or implement Firefox testing with playwright-webextext.",
  "category": "troubleshooting",
  "dateCreated": "2025-11-23T03:06:26.763Z",
  "dateUpdated": "2025-11-23T03:06:26.763Z"
}