{
  "id": "ee09ba5c-3571-44e0-a857-4b4fc70bfca9",
  "title": "Chromium 136+ CI Environment Launch Requirements",
  "content": "When launching Chromium 136+ with extensions in CI environments (GitHub Actions with Xvfb), specific Chrome arguments are REQUIRED for successful browser launch.\n\n**Root Cause of Launch Timeouts in CI**:\n1. Chromium 136+ introduced stricter remote debugging port restrictions\n2. Virtual display servers (Xvfb) require GPU and rendering adjustments  \n3. CI environments have limited shared memory\n4. DBus connection failures in containerized environments\n\n**Required Chrome Arguments**:\n\n```javascript\nconst context = await chromium.launchPersistentContext(userDataDir, {\n  headless: false, // Required for extensions\n  timeout: 60000, // Increased for CI stability\n  slowMo: 100, // Optional: slows operations for CI\n  args: [\n    // Extension loading\n    `--disable-extensions-except=${extensionPath}`,\n    `--load-extension=${extensionPath}`,\n    \n    // CRITICAL for Chromium 136+\n    '--disable-features=DevToolsDebuggingRestrictions',\n    \n    // Virtual display (Xvfb) compatibility\n    '--disable-gpu',\n    '--disable-dbus',\n    '--disable-software-rasterizer',\n    \n    // CI environment stability\n    '--no-sandbox',\n    '--disable-setuid-sandbox',\n    '--disable-dev-shm-usage',\n    \n    // Optimize teardown\n    '--disable-component-extensions-with-background-pages',\n    '--disable-default-apps',\n    '--disable-blink-features=AutomationControlled'\n  ]\n});\n```\n\n**Why Each Argument is Needed**:\n\n**`--disable-features=DevToolsDebuggingRestrictions`** (Chromium 136+):\n- New security restriction prevents remote debugging in certain contexts\n- Essential for launchPersistentContext with extensions\n- Without this: Browser launches but Playwright can't connect (60s timeout)\n\n**`--disable-gpu`** (Xvfb):\n- GPU not available in virtual display environments\n- Prevents hanging on GPU initialization\n- Required for headed mode in CI\n\n**`--disable-dbus`** (CI containers):\n- DBus not available/accessible in many CI environments\n- Prevents \"Permission denied\" errors connecting to /run/user/0/bus\n- These errors don't block launch but can cause timeouts\n\n**`--disable-dev-shm-usage`** (CI memory):\n- Shared memory (/dev/shm) often limited in Docker/CI\n- Prevents \"Cannot allocate memory\" errors\n- Essential for stable test execution\n\n**`--no-sandbox` + `--disable-setuid-sandbox`** (CI permissions):\n- Sandbox requires specific kernel features/permissions\n- Often not available in containerized CI\n- Standard for Playwright in CI environments\n\n**Common Launch Timeout Symptoms**:\n```\nError: browserType.launchPersistentContext: Timeout 60000ms exceeded.\nCall log:\n  - <launching> chrome ...\n  - <launched> pid=12345\n  - [pid=12345][err] Failed to connect to the bus: Permission denied\n  - [pid=12345][err] Cannot use V8 Proxy resolver in single process mode.\n```\n\n**How to Diagnose**:\n1. Enable Playwright debug logging: `PW_DEBUG=pw:api`\n2. Check if browser binary exists: `ls ~/.cache/ms-playwright/chromium-*/chrome-linux/chrome`\n3. Verify extension files: `ls dist/manifest.json`\n4. Check Xvfb is running: `ps aux | grep Xvfb`\n5. Verify DISPLAY: `echo $DISPLAY`\n\n**Browser Installation**:\n```bash\n# MUST run before tests\nnpx playwright install chromium\n```\n\n**Common Mistakes**:\n- ❌ Forgetting to install Playwright browsers\n- ❌ Using `--single-process=true` (causes V8 proxy errors)\n- ❌ Not setting DISPLAY environment variable\n- ❌ Using old Chrome flags that no longer work in 136+\n- ❌ Not increasing timeout beyond default 30s\n\n**Working CI Workflow**:\n```yaml\n- name: Install browsers\n  run: npx playwright install chromium\n\n- name: Start Xvfb\n  run: Xvfb :99 -screen 0 1920x1080x24 &\n\n- name: Run tests\n  env:\n    DISPLAY: :99\n  run: npm test\n```\n\n**Research Sources**:\n- Playwright GitHub Issues: #31769, #14078, #28336, #35836\n- Chrome DevTools debugging restrictions (Chromium 136+)\n- Xvfb virtual display best practices\n- CI containerized environment limitations",
  "metadata": {},
  "createdAt": "2025-11-23T00:48:30.680Z",
  "updatedAt": "2025-11-23T00:48:30.680Z",
  "category": "troubleshooting"
}
