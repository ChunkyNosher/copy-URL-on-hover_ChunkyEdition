{
  "id": "99dcc0a2-4b5e-4740-848c-dd0be873d686",
  "title": "Integration Test DOM Mocking Challenge",
  "details": "Challenge encountered while implementing integration tests for Issue #47:\n\n**Problem:** Integration tests need to verify cross-tab synchronization without actual DOM.\n- `initQuickTabs()` creates real QuickTabWindow instances with iframes\n- Jest environment doesn't have real browser DOM\n- Need to mock `createQuickTabWindow` at integration level\n\n**Lessons Learned:**\n1. Jest.mock() needs to be at top level to properly intercept imports\n2. The mock must return objects that match QuickTabWindow interface\n3. Integration tests should focus on PROTOCOL not DOM rendering\n4. Unit tests already cover DOM creation - integration tests should test synchronization\n\n**Recommended Approach (from Perplexity):**\n- Mock `createQuickTabWindow` to return mock window objects\n- Test cross-tab message propagation and state consistency\n- Verify BroadcastChannel protocol works correctly\n- Don't test actual iframe rendering (that's E2E testing)\n\n**Alternative Simpler Approach:**\n- Test components in isolation (BroadcastManager + StateManager + StorageManager)\n- Don't use full `initQuickTabs()` in integration tests\n- Focus on verifying the synchronization contract between components\n- This is what existing cross-tab unit tests do successfully\n\n**Files:**\n- tests/integration/scenarios/scenario-01-basic-cross-tab-sync.test.js (WIP)\n- tests/unit/managers/BroadcastManager.crossTab.test.js (GOOD EXAMPLE)\n- tests/helpers/cross-tab-simulator.js (framework ready)",
  "category": "troubleshooting",
  "dateCreated": "2025-11-23T16:41:38.899Z",
  "dateUpdated": "2025-11-23T16:41:38.899Z"
}