{
  "id": "47ad9482-a8af-40b5-8cde-8a8060710cc6",
  "title": "Cross-Tab Sync via storage.onChanged",
  "details": "## Quick Tab Cross-Tab Synchronization Fix (v1.6.2)\n\n### Problem\nQuick Tabs were not syncing between browser tabs after the storage.local migration because:\n1. Content scripts didn't have a handler for `SYNC_QUICK_TAB_STATE_FROM_BACKGROUND` message\n2. SyncCoordinator was passing raw storage data to StateManager.hydrate() which expects QuickTab instances\n\n### Solution\n\n**1. Added message handler in content.js:**\n```javascript\nif (message.action === 'SYNC_QUICK_TAB_STATE_FROM_BACKGROUND') {\n  _handleQuickTabStorageSync(message, sendResponse);\n  return true;\n}\n```\n\nThe helper function routes to SyncCoordinator:\n```javascript\nfunction _handleQuickTabStorageSync(message, sendResponse) {\n  quickTabsManager.syncCoordinator.handleStorageChange(message.state);\n}\n```\n\n**2. Fixed type mismatch in SyncCoordinator:**\n```javascript\nimport { QuickTab } from '@domain/QuickTab.js';\n\n// Convert raw data to QuickTab instances\nconst quickTabData = this._extractQuickTabsFromStorage(newValue);\nconst quickTabs = quickTabData.map(data => QuickTab.fromStorage(data));\nthis.stateManager.hydrate(quickTabs);\n```\n\n### Complete Event Flow\n```\nTab A writes to storage.local\n    ↓\nstorage.onChanged fires in background script\n    ↓\nBackground broadcasts SYNC_QUICK_TAB_STATE_FROM_BACKGROUND\n    ↓\nContent script → _handleQuickTabStorageSync()\n    ↓\nSyncCoordinator.handleStorageChange() → QuickTab.fromStorage()\n    ↓\nStateManager.hydrate() → emit state:added/updated/deleted\n    ↓\nUICoordinator listeners → render/update/destroy\n```\n\n### Key Files\n- src/content.js - Message handler\n- src/features/quick-tabs/coordinators/SyncCoordinator.js - QuickTab conversion\n- src/features/quick-tabs/managers/StateManager.js - Expects QuickTab instances",
  "category": "troubleshooting",
  "dateCreated": "2025-11-25T04:57:32.888Z",
  "dateUpdated": "2025-11-25T04:57:32.888Z"
}