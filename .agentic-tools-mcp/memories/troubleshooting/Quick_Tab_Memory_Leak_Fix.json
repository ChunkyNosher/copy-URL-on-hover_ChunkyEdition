{
  "id": "6d4ac0da-4f8d-44fe-8a35-a4871ab0f4ec",
  "title": "Quick Tab Memory Leak Fix",
  "details": "## Critical Memory Leak Fix (v1.6.0.x)\n\n### Root Cause\nThe Quick Tab broadcast history persistence mechanism caused an infinite feedback loop:\n`_persistBroadcastMessage()` → storage write → storage.onChanged event → StorageManager processing → more writes → LOOP\n\nThis was causing ~900MB/second memory consumption and browser freeze within 30-40 seconds.\n\n### Solution Components\n\n1. **MemoryGuard** (`src/features/quick-tabs/guards/MemoryGuard.js`)\n   - Monitors JS heap memory via `performance.memory.usedJSHeapSize`\n   - Default thresholds: 1000MB extension, 20000MB browser\n   - Emits 'memory:emergency-shutdown' event when exceeded\n\n2. **Write Rate Limiter** (BroadcastManager.js)\n   - `maxWritesPerSecond=10`, `writeRateWindow=1000ms`\n   - `_checkWriteRateLimit()` blocks excessive writes\n   - Logs warning every 100 blocked writes\n\n3. **Circuit Breaker** (StorageManager.js)\n   - States: CLOSED (normal), OPEN (blocking), HALF_OPEN (testing)\n   - `failureThreshold=5`, `successThreshold=2`, `resetTimeoutMs=10000`\n   - Prevents storage operation storms\n\n4. **Storage Change Filtering** (StorageManager.js)\n   - Ignores keys starting with `quicktabs-broadcast-history-`\n   - Ignores keys starting with `quick-tabs-sync-`\n   - Uses `Object.entries()` for efficient filtering\n\n5. **Temporarily Disabled Features**\n   - `_persistBroadcastMessage()` - returns immediately\n   - `replayBroadcastHistory()` - returns 0 immediately\n   - `startPeriodicSnapshots()` - returns immediately\n\n### Re-enabling Disabled Features\nTo re-enable broadcast history:\n1. Implement proper write batching with `pendingHistoryWrites` array\n2. Add `BATCH_WRITE_DELAY_MS = 500` for deferred writes\n3. Create `_flushPendingHistoryWrites()` method\n4. See git history for original implementations",
  "category": "troubleshooting",
  "dateCreated": "2025-11-24T21:12:38.581Z",
  "dateUpdated": "2025-11-24T21:12:38.581Z"
}