{
  "id": "b53ae164-4bf2-41cb-8f5a-0769d3e31036",
  "title": "Test Bridge CSP Bypass with Blob URLs",
  "content": "## Test Bridge Injection CSP Bypass Strategy\n\n### Problem\nContent script injection using `script.textContent` fails silently due to CSP restrictions. The test bridge never reaches the page's main world.\n\n### Root Cause (Verified via Perplexity)\n- Content scripts run in isolated world\n- Inline scripts (`script.textContent`) require CSP `'unsafe-inline'` permission\n- Most pages don't allow `'unsafe-inline'` for security\n- Previous approach: `script.textContent = code` → blocked by CSP\n\n### Solution: Blob URL Injection\nPerplexity research confirmed: Blob URLs bypass CSP `script-src` restrictions more reliably than inline scripts.\n\n**Implementation:**\n```javascript\nconst blob = new Blob([code], { type: 'application/javascript' });\nconst blobUrl = URL.createObjectURL(blob);\nconst script = document.createElement('script');\nscript.src = blobUrl; // Use src, not textContent\nscript.onload = () => URL.revokeObjectURL(blobUrl);\n```\n\n### Manifest V2 Compatibility\n✅ Blob URLs are 100% Manifest V2 compatible\n✅ No V3-only APIs required\n✅ Works in both Firefox and Chrome\n\n### Additional Fixes\n1. **Content Script Marker**: Added `<meta name=\"copilot-content-script-loaded\">` for verification\n2. **Defensive Polling**: Retry up to 50 times (500ms) for DOM readiness\n3. **Enhanced Logging**: Detailed logs at injection and page proxy levels\n4. **all_frames: true**: Content script runs in all frames, not just top\n5. **Error Handling**: Fallback to extension URL if Blob fails\n\n### Limitations\nIf page CSP explicitly blocks `blob:` origins, injection will still fail. However, most pages don't block blob URLs.",
  "metadata": {},
  "createdAt": "2025-11-23T04:01:13.339Z",
  "updatedAt": "2025-11-23T04:01:13.339Z",
  "category": "troubleshooting"
}
