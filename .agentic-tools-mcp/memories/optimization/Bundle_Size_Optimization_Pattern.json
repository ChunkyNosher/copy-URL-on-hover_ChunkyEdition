{
  "id": "565ec755-69ee-4c03-b467-8faca5d5c6d9",
  "title": "Bundle Size Optimization Pattern",
  "details": "## Bundle Size Optimization Pattern (v1.6.3.6-v11)\n\n### Problem: Test Infrastructure in Production Bundle\nTest handler functions (20+ handlers, ~40KB) were included in production builds because they weren't conditionally compiled.\n\n### Solution: Conditional Compilation with process.env.TEST_MODE\n\n1. **Declare variables at module level as undefined**:\n```javascript\nconst IS_TEST_MODE = process.env.TEST_MODE === 'true';\nlet _testHandleCreateQuickTab;\n// ... more handlers\n```\n\n2. **Define handlers only in test mode**:\n```javascript\nif (IS_TEST_MODE) {\n  _testHandleCreateQuickTab = (data, sendResponse) => { ... };\n  // ... define all test handlers\n}\n```\n\n3. **Conditionally register in TYPE_HANDLERS**:\n```javascript\nif (IS_TEST_MODE) {\n  Object.assign(TYPE_HANDLERS, {\n    'TEST_CREATE_QUICK_TAB': (m, s) => { _testHandleCreateQuickTab(m.data, s); return true; },\n    // ... more\n  });\n}\n```\n\n### Build Scripts\n- `build:prod`: No TEST_MODE - excludes test handlers\n- `build:test`: TEST_MODE=true - includes test handlers\n\n### Tree-Shaking Configuration (.buildconfig.json)\n```json\n{\n  \"treeshake\": {\n    \"preset\": \"smallest\",\n    \"moduleSideEffects\": false,\n    \"propertyReadSideEffects\": false,\n    \"tryCatchDeoptimization\": false\n  }\n}\n```\n\n**WARNING**: These aggressive settings only work for browser extensions (not libraries). They assume modules have no side effects on import.\n\n### Results\n- Production content.js: 234KB (down from 245KB, ~4% reduction)\n- Test handlers: 0 in production, 9+ in test build\n- All 1615 tests passing",
  "category": "optimization",
  "dateCreated": "2025-12-09T01:34:37.626Z",
  "dateUpdated": "2025-12-09T01:34:37.626Z"
}