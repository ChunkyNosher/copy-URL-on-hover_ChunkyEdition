{
  "id": "f353000d-a0ad-4a72-9f9d-4abd1dbd8a15",
  "title": "v1.6.3.4-v7 Hydration Bug Fixes",
  "details": "## v1.6.3.4-v7 Critical Hydration Architecture Fixes\n\n### Problem\nQuick Tab restore/minimize operations failed 100% of the time when Manager panel was open because hydration created fake placeholder objects instead of real QuickTabWindow instances.\n\n### Root Causes Fixed\n\n1. **Issue #1 - Fake Objects**: `_hydrateMinimizedTab()` created plain JS objects, not QuickTabWindow instances\n   - FIX: Use `new QuickTabWindow({...})` directly (NOT `createQuickTabWindow()` because it calls render())\n\n2. **Issue #2 - Undefined URLs**: QuickTab entities had url: undefined after hydration\n   - FIX: Added URL validation in UICoordinator.render() before _createWindow()\n\n3. **Issue #3 - Silent Failures**: handleMinimize/handleRestore didn't return error info\n   - FIX: Return `{ success, error }` objects, message handlers propagate errors\n\n4. **Issue #4 - Ghost Windows**: 400x300 windows at (100,100) from fallback dimensions\n   - FIX: Window creation wrapped in try/catch, returns null on failure\n\n5. **Issue #5 - Duplicate Iframes**: Multiple render paths firing simultaneously\n   - FIX: Added `_renderTimestamps` Map with RENDER_COOLDOWN_MS = 1000\n\n6. **Issue #6 - Lock Leaks**: Locks never released after failed operations\n   - FIX: try/finally pattern guarantees _releaseLock() is called\n\n7. **Issue #7 - Empty Maps**: renderedTabs always size 0\n   - FIX: Emit state:added events during hydration for UICoordinator tracking\n\n### Key Patterns\n\n```javascript\n// Instance validation before operations\nif (typeof tabWindow.restore !== 'function') {\n  this.quickTabsMap.delete(id);\n  return;\n}\n\n// Lock cleanup with try/finally\ntry { /* operations */ } finally { this._releaseLock('restore', id); }\n\n// Handler return objects\nreturn { success: false, error: 'Tab not found' };\n```\n\n### Files Modified\n- src/features/quick-tabs/index.js\n- src/features/quick-tabs/coordinators/UICoordinator.js\n- src/features/quick-tabs/handlers/VisibilityHandler.js\n- src/content.js\n- manifest.json (v6 â†’ v7)",
  "category": "technical_decisions",
  "dateCreated": "2025-12-01T07:09:52.613Z",
  "dateUpdated": "2025-12-01T07:09:52.613Z"
}